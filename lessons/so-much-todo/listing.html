<section id="todoapp">
    <header id="header">
        <h1>todos</h1>
        <input type="text" id="new-todo" placeholder="What needs to be done?" onkeydown="SoMuch.controllers.Changes.create(event)" />
    </header>
    <section id="main">
        <ul id="todo-list">
            {{~it.todos :todo}}
            <li {{? todo.status == "completed" }}class="completed"{{?}}>
                <div class="viewing">
                    <input 
                        type="checkbox" class="toggle" 
                        onclick="SoMuch.controllers.Changes.toggle({{=todo.id}},'{{= todo.status == 'active' ? 'completed' : 'active'}}')" 
                        {{? todo.status == "completed" }}checked{{?}}
                    />
                    <label ondblclick="SoMuch.controllers.Changes.edit(this)">{{=todo.text}}</label>
                    <button class="destroy" onclick="SoMuch.controllers.Changes.destroy({{=todo.id}})" />
                </div>
                <div class="editing" style="display: none">
                    <input 
                        type="text" value="{{!todo.text}}" class='edit' 
                        onkeydown="SoMuch.controllers.Changes.update(event,{{=todo.id}})"
                        onblur="SoMuch.controllers.Changes.update(event,{{=todo.id}})"
                    />
                </div>
            </li>
            {{~}}
        </ul>
        <input 
            type="checkbox" id="toggle-all" 
            {{? it.counts.completed == it.counts.total }}checked{{?}}
            onclick="SoMuch.controllers.Changes.toggle(null,'{{= it.counts.completed == it.counts.total ? 'active' : 'completed'}}')"
         /> 
    </section>
    <footer id="footer">
        <span id="todo-count">
            <strong>{{=it.counts.active}}</strong> todo{{?it.counts.active > 1}}s{{?}} left
        </span>
        <ul id="filters">
            <li>
                <a 
                    href="{{=SoMuch.link('all')}}" 
                    {{? SoMuch.current.route.name == "all"}}class="selected"{{?}}
                >All</a>
            </li>
            <li>
                <a 
                    href="{{=SoMuch.link('some','active')}}" 
                    {{? SoMuch.current.route.name == "some" && SoMuch.current.path.status == "active" }}class="selected"{{?}}
                >Active</a>
            </li>
            <li>
                <a 
                    href="{{=SoMuch.link('some','completed')}}" 
                    {{? SoMuch.current.route.name == "some" && SoMuch.current.path.status == "completed" }}class="selected"{{?}}
                >Completed</a>
            </li>
        </ul>
        <button id="clear-completed" onclick="SoMuch.controllers.Changes.purge()" >
            Clear completed ({{=it.counts.completed}})
        </button>
    </footer>
</section>
<footer id="info">
    <p>Double-click to edit a todo</p>
</footer>
